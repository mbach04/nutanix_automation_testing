---
- name: OCP CNS Deployer
  hosts: glusterfs
  gather_facts: true
  tasks:
    - name: Deploy CNS on OCP
      include_role:
        name: container-native-storage

- name: Configure masters for CNS deployment
  hosts: masters
  gather_facts: true
  tasks:
    - name: Enable the gluster repos for all Masters
      yum_repository:
        name: local_server_gluster
        state: present
        baseurl: "http://repository.{{ vm_net_domain }}/repos/yum/rh-gluster-3-client-for-rhel-7-server-rpms"
        description: local_server_gluster
        gpgcheck: no

    - name: Install required CNS packages on OCP Masters
      yum:
        name: "{{ item }}"
        state: latest
      with_items:
        - cns-deploy
        - heketi-client

    - name: Disable the gluster repos for all Masters
      yum_repository:
        name: local_server_gluster
        state: absent